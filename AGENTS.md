# AGENTS.md

> Multi-agent workflow for OnePan, a warm, focused, Flutter-based cooking app. Code may be generated by LLMs, but direction, constraints, and acceptance criteria come from the human-authored docs below.

---

## Source of Truth (All Agents MUST Read)

| Purpose | Doc |
|--------|-----|
| Vision, tone, and promise | README.md |
| Screens and milestones | Project_Plan.md |
| Feature rules, substitution logic, data contracts | Project_Specs.md |
| Visual tone, spacing, and interaction rules | UI_Principles.md |

Order of authority if conflicts appear: UI_Principles.md → Project_Specs.md → Project_Plan.md → README.md

---

## Global Principles

- Scope: One-pan recipes. Two modes — Simple (static) and AI (two LLM calls).
- Schema parity: Both modes must use the same Recipe/Ingredients/Steps v1 schema.
- LLM use is opt-in: No hidden calls. AI Mode makes two calls — after Ingredient Picker (Ingredient Finalizer) and after Finalizer (Recipe Generation).
- No free-text inputs: UI → structured params only (servings, timeMode, spice).
- One-pan constraint: Steps must not require extra cookware.
- Fallbacks & caching: On LLM failure, revert to base; cache successful AI results by documented key.
- Accessibility & readability: Large tap targets, readable type, calm motion.

---

## Architecture & Tech Stack (Summary)

- Platform: Flutter (Android first)
- Routing: go_router
- State: Riverpod
- Data: Hive (saved recipes), SharedPreferences (prefs), dio (network)
- LLM / Remote: Optional behind a replaceable repository (mock first)
- Separation: Data → Domain → UI; repositories must be swappable

Follow scope per Project_Plan.md and UI rules in UI_Principles.md.

---

## Agents & Responsibilities

1) Product Owner (PO-Agent)
- Convert the four core docs into user stories with acceptance criteria.
- Guard scope per plan; Mode Choice screen and two LLM calls are in scope.
- Output: docs/stories/*.md, labeled backlog.

2) UX-Agent (Design System & Flow)
- Encode palette/spacing/type/interaction rules from UI_Principles.md.
- Produce component contracts and screen states (loading/empty/error/ready).
- Enforce one primary CTA.
- Output: ui/components.md, token definitions under lib/app/theme/*.

3) ARCH-Agent (Architecture)
- Own folder structure, DI, and routing.
- Ensure repositories are swappable; LLM is optional.
- Output: docs/architecture.md, base Flutter scaffold, CI config.

4) DATA-Agent (Schema & Seeds)
- Define Recipe v1 models and step/ingredient structure tied to Project_Specs.md.
- Provide 3–10 curated seed recipes.
- Output: lib/data/models/*, assets/recipes.json.

5) FE-Agent (Flutter UI)
- Build screens per plan using tokens (no raw hex/magic numbers), including Mode Choice, Ingredient Finalizer, and Recipe view.
- Implement loading/empty/error/ready states and accessibility sizing from UI_Principles.md.
- Output: lib/features/* screens and shared widgets.

6) BE-Agent (Repositories & Adapters)
- Implement two-call AI adapter behind a swappable interface:
  - Call 1: Ingredient Finalizer (inputs: recipeId, params, availableIds, missingIds) → finalIngredients + substitutions
  - Call 2: Recipe Generation (inputs: recipeId, params, finalIngredients) → steps + timeTotalMin
- Enforce schema v1; accept timeMode; implement caching + fallbacks.
- Output: lib/data/repositories/*, lib/data/sources/{local,remote}/*.

7) QA-Agent (Quality)
- Widget/unit/golden tests; scenario flows per Project_Plan.md.
- Keep flake rate low; cover happy paths and common errors.
- Output: test/{unit,widget,golden}/*.

8) DOCS-Agent (Docs & Releases)
- Keep docs current with every PR; maintain contributor path.
- Output: CONTRIBUTING.md, CHANGELOG.md, updates to /docs.

---

## Working Rules

- Contracts first: Define schema, tokens, and screen states before feature work.
- No scope creep: Only the screens/features defined in Project_Plan.md.
- Design tokens only: No hardcoded spacing, sizes, or colors; follow UI_Principles.md.
- Small PRs: Prefer tight loops and clear diffs; include screenshots for UI changes.
- LLM code is reviewed: AI can draft, humans must approve.

---

## Definition of Done

A feature is complete only if:
1. It meets acceptance criteria from PO-Agent stories.
2. UI and interactions conform to UI_Principles.md.
3. Data contracts and behavior follow Project_Specs.md.
4. It stays within scope of Project_Plan.md.
5. Loading/empty/error states are implemented; LLM calls (if used) validate against schema and have fallbacks.

---

## MVP Outcome

A user can:
1. Set onboarding preferences
2. Browse recipes
3. Customize time/servings/spice
4. Pick ingredients they have
5. Finalize the ingredient list (AI substitutions)
6. Generate final steps/time (AI Mode) and follow a clean recipe view

No additional features beyond plan until after MVP.

---

## Post-MVP (Locked Until After First Release)

- Pantry memory
- Cook-mode timers

(Tracked but not part of MVP; revisit after initial release.)

